services:
  ################## MySql #####################
  mysql:
    build:
      context: mysql/
      args:
        MYSQL_VERSION: $MYSQL_VERSION
    volumes:
      - type: bind
        source: ./mysql/config/mysql.cnf
        target: /etc/mysql/conf.d/my.cnf
        read_only: true
    ports:
      - "3306:3306"
    # https://hub.docker.com/_/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=root123
      - MYSQL_DATABASE=shopping-cart
      - MYSQL_USER=system
      - MYSQL_PASSWORD=admin123
      - MYSQL_ROOT_HOST=%
    networks:
      - elk

  
  consul:
    image: consul:1.12
    mem_limit: 4098m
    mem_reservation: 1024M
    cpus: 1
    deploy:
      restart_policy:
        condition: on-failure
        max_attempts: 5
    environment:
      CONSUL_LOCAL_CONFIG: '{"leave_on_terminate": true}'
    command: agent -dev -client=0.0.0.0
    ports:
      - 8500:8500
    networks:
      - elk


networks:
  elk:
    driver: bridge

volumes:
  elasticsearch:
